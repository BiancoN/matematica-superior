<!DOCTYPE html>
<html class="principal">
<head>
    <script src="plotly-latest.min.js"></script>
    <script src="math.min.js"></script>

    <meta charset="UTF-8">
    <title>Aproximacion parabólica</title>
</head>
<body>

<h1 class="titulo-principal">Aproximacion parabólica</h1>
<p class="inicio"><a href="index.html">Volver al inicio</a></p>

<br/>

<script>window.$ = window.jQuery = require('jquery');</script>


<form class="formulario">


    <div class="table-responsive">
        <table id="tablaValores" class="table" style=" width: 98%; margin-left: 1%;">
            <tr><th>X</th><th>Y</th></tr>
            <tr><td> <input style="width: 100%; border: 0px;" class="x" type="number"></td>
                <td><input style="width: 100%; border: 0px;" type="number" class="y"></td></tr>
        </table>
    </div>


    <br>

    <div class="row-fluid">
        <button type="button" id="Agregar" class="btn btn-primary" style="margin-bottom: 25px; margin-left: 1%; position: inherit; float: left;">Agregar valor</button>
        <div class="form-group">
            <input type="number" placeholder="Cantidad de decimales" class="form-control" id="usr" value="2" style="margin-bottom: 25px; margin-right: 60%; width: 23%;float: right; position: inherit;">
        </div>
    </div>

    <br>

    <button type="button" id="Generar" class="btn btn-warning" style=" margin-left: 1%; margin-bottom: 25px;">Generar Tabla</button>

    <br>

    <table id="tablaResultados">

    </table>

    <br>

    <div id="resultado"></div>


    <br/>

    <div id="myDiv" ></div>





</form>


<script>
    // You can also require other files to run in this process
    //require('./renderer.js')

    require('./jquery-3.2.1.min')

    $( document ).ready(function() {
        $("#masCampos").click(function() {
            $("#tabla").append("<tr><td><input type=\"number\" id=\"valorx\" class=\"casillero\"></td>" +
                "<td><input type=\"number\" id=\"valory\" class=\"casillero\"></td></tr>");
        });

    });


    var valores = [];
    $("#Agregar").click(function(){
        $("#tablaValores").append("<tr><td> <input rype=\"number\" style=\"width: 100%; border: 0px;\" class=\"x\"></td>" +
            "<td><input rype=\"number\" style=\"width: 100%; border: 0px;\"class=\"y\"></td></tr>");
    });


    $("#Generar").click(function(){
        valores = [];
        $("#tablaResultados").html("<tr><th></th><th>X</th><th>Y</th><th>X^2</th><th>X^3</th><th>X^4</th><th>XY</th><th>X^2Y</th></tr>");
        $('#tablaValores tr').each(function() {
            x=parseInt($(this).find(".x").val());
            y=parseInt($(this).find(".y").val());
            if($.isNumeric(x)&&$.isNumeric(y)){
                valores.push([x,y,x*x,x*x*x,x*x*x*x,x*y,x*x*y]);
            }
        });
        //array.push(values);

        n=valores.length;
        sumx=0;sumy=0;sumxx=0;sumxxx=0;sumxxxx=0;sumxxy=0;sumxy=0;
        for(i=0;i<valores.length;i++){
            sumx+= valores[i][0];
            sumy+=valores[i][1];
            sumxx+=valores[i][2];
            sumxxx+=valores[i][3];
            sumxxxx+=valores[i][4];
            sumxy+=valores[i][5];
            sumxxy+=valores[i][6];
            $("#tablaResultados").append("<tr><td></td><td>"+valores[i][0]+"</td>"+"<td>"+valores[i][1]+"</td>"+"<td>"+valores[i][2]+"</td>"+"<td>"+valores[i][3]+"</td>"+"<td>"+valores[i][4]+"</td>" + "<td>"+valores[i][5]+"</td>"+"<td>"+valores[i][6]+"</td></tr>");

        }

        $("#tablaResultados").append("<tr><td>Σ</td><td>"+sumx+"</td>"+"<td>"+sumy+"</td>"+"<td>"+sumxx+"</td>"+"<td>"+sumxxx+"</td>"+"<td>"+sumxxxx+"</td>"+"<td>"+sumxy+"</td>"+"<td>"+sumxxy+"</td></tr>");



        var m = [[n,sumx,sumxx], [sumx,sumxx,sumxxx],[sumxx,sumxxx,sumxxxx]];
        var s = [sumy,sumxy,sumxxy];


        try {
            var r = math.lusolve(m, s);  // [[8], [9]]
        }
        catch(err) {
            alert("La matriz no puede ser resuelta porque es singular (ingresar mas valores)");
        }


        console.log(m);
        console.log(s);
        console.log(n);
        console.log(r);

        //<div id="pepe" style='display:none'></div>    $("#pepe").show(); / hide()

        redondeo= 10**(parseInt($("#usr").val()));
        console.log("red"+redondeo);

        a = Math.round(r[2] * redondeo) / redondeo;//((sumy*sumxxxx-sumxx*sumxxy)/(n*sumxxxx-sumxx*sumxx)).toFixed(2);
        b = Math.round(r[1] * redondeo) / redondeo; //(sumxy/sumxx).toFixed(2);
        c = Math.round(r[0] * redondeo) / redondeo;//((n*sumxxy-sumy*sumxx)/(sumxxxx-sumxx*sumxx)).toFixed(2);

        $("#resultado").html("Funcion aproximada: Y=("+a+")*X^2 +"+" ("+b+")*X + "+" ("+c+")");

        datax=[];
        datay=[];
        labelsValues=[0];


        function arrayMax(array) {
            return array.reduce(function(a, b) {
                return Math.max(a, b);
            });
        }



        function arrayMin(array) {
            return array.reduce(function(a, b) {
                return Math.min(a, b);
            });
        }

        dataset2=[];
        console.log(n);

        for(i=0;i<n;i++){
            dataset2[i]={x:valores[i][0],y:valores[i][1]};
            datax[i] = valores[i][0];
            datay[i] = valores[i][1];
        }
        console.log(dataset2);
        minimo = arrayMin(datax);
        maximo = arrayMax(datax);


        dataset1=[];

        for(i=0;i<1000;i++){
            labelsValues[i]=minimo+i*((maximo-minimo)/1000);
            dataset1[i]=c+labelsValues[i]*b+labelsValues[i]*labelsValues[i]*a;
        }




     //   for(i=0;i<=n;i++){

          //  dataset1[i]=parseInt(c)+datax[i]*parseInt(b)+datax[i]*datax[i]*parseInt(a);
       // }




        var funcion = {
            x: labelsValues,
            y: dataset1,
            type: 'scatter',
            name: 'Aproximacion funcion'
        };

        // Valores de la tabla
        var puntos = {
            x: datax,
            y: datay,
            mode: 'markers',
            name: 'Puntos tabla'
        };

        var data = [funcion, puntos];

        Plotly.newPlot('myDiv', data);


    });






</script>

<link rel="stylesheet" type="text/css" href="estilos.css">
<link href="node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
</body>
</html>
